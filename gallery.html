<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="styles/style.css" />
    <link rel="stylesheet" href="styles/nav.css">
    <link rel="stylesheet" href="styles/offers.css">
    <link rel="stylesheet" href="styles/grid-gallery.css">
    <link rel="stylesheet" href="styles/jak-powstaje.css">
    <link rel="stylesheet" href="styles/home.css">
    <link rel="stylesheet" href="styles/gallery.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- Bootstrap CSS from CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Fotorama CSS from CDN -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/fotorama/4.6.4/fotorama.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://unpkg.com/flickity@2/dist/flickity.min.css">
    <link rel="stylesheet" href="styles/bootsrap-overrides.css">
    <script id="galleries" type="application/json">
    {
        "skalny": {
            "name": "ogród skalny",
            "subtitle": "stylizowany na japoński",
            "description": "Oto jak stworzyć piękny, japoński ogród w swojej przestrzeni mieszkalnej! Oczywiście, nie trzeba przesadzać z stylizacją, aby uzyskać wspaniały efekt. Możesz dodać kilka elementów, które nawiązują do japońskiej kultury, takich jak żwirowa ścieżka wspinająca się pod górę lub naturalne ułożenie głazów na skarpie. Nie zapomnij również o roślinach, które występują w stanie naturalnym w Azji i dobrze radzą sobie w naszym klimacie, takich jak klon japoński, magnolie, sosny i azalie. I na koniec, dodaj prostą, drewnianą ławkę, aby w pełni cieszyć się lekkością orientalnej estetyki.",
            "location": "okolice Andrychowa",
            "thumbnailImage": {
                "title": "Złote Liście",
                "description": "Drzewa pokryte złotymi liśćmi w parku, które tworzą niesamowity dywan na ziemi. To widok, który zachwyca każdego miłośnika jesiennych krajobrazów. Spacer po takim parku to prawdziwa uczta dla zmysłów – szelest liści pod stopami, zapach wilgotnej ziemi i delikatny powiew jesiennego wiatru.",
                "img": "portfolio/skalny/1_edited.jpg"
            },
            "date": "2023",
            "images": [
                {
                    "description": "Zdjęcie przedstawia piękne drzewa w pełnym rozkwicie, pokryte różowymi i białymi kwiatami. To widok, który zachwyca każdego miłośnika przyrody. Kwitnące drzewa symbolizują odrodzenie i nowy początek, a ich delikatne kwiaty tworzą niesamowity kontrast z błękitnym niebem.",
                    "img": "portfolio/skalny/1_edited.jpg"
                },
                {
                    "description": "Kolorowa łąka pełna wiosennych kwiatów, takich jak tulipany, krokusy i żonkile. To miejsce, które emanuje spokojem i pięknem natury. Spacer po takiej łące to prawdziwa uczta dla zmysłów – zapach kwiatów, śpiew ptaków i delikatny powiew wiosennego wiatru sprawiają, że czujemy się częścią tego magicznego świata.",
                    "img": "portfolio/skalny/IMG_0061.jpg"
                },
                {
                    "img": "portfolio/skalny/PICT0107a.jpg"
                },
                {
                    "img": "portfolio/skalny/PICT0115a.jpg"
                },
                {
                    "description": "Kolorowa łąka pełna wiosennych kwiatów, takich jak tulipany, krokusy i żonkile. To miejsce, które emanuje spokojem i pięknem natury. Spacer po takiej łące to prawdziwa uczta dla zmysłów – zapach kwiatów, śpiew ptaków i delikatny powiew wiosennego wiatru sprawiają, że czujemy się częścią tego magicznego świata.",
                    "img": "portfolio/skalny/PICT0124a.jpg"
                },
                {
                    "description": "Kolorowa łąka pełna wiosennych kwiatów, takich jak tulipany, krokusy i żonkile. To miejsce, które emanuje spokojem i pięknem natury. Spacer po takiej łące to prawdziwa uczta dla zmysłów – zapach kwiatów, śpiew ptaków i delikatny powiew wiosennego wiatru sprawiają, że czujemy się częścią tego magicznego świata.",
                    "img": "portfolio/skalny/PICT0139.jpg"
                }
            ]
        },
        "letnia": {
            "name": "Galeria Letnia",
            "description": "Galeria ukazująca uroki lata, kiedy słońce świeci najjaśniej, a przyroda jest w pełnym rozkwicie. Lato to czas wakacji, podróży i odkrywania pięknych miejsc. W tej galerii znajdziesz obrazy pełne energii i życia – od spokojnych plaż nad morzem, przez bujne ogrody, aż po majestatyczne góry. Każde zdjęcie przypomina o radości, jaką niesie lato, i o chwilach, które warto zapamiętać na zawsze.",
            "location": "Kraków, Polska",
            "thumbnailImage": {
                "title": "Plaża nad Morzem",
                "description": "Piękna plaża z widokiem na spokojne morze, gdzie fale delikatnie obmywają brzeg. To idealne miejsce na odpoczynek, opalanie i cieszenie się letnim słońcem. Plaża jest otoczona złotym piaskiem, a w oddali widać horyzont, który zdaje się nie mieć końca. To miejsce, które koi zmysły i pozwala zapomnieć o codziennych troskach.",
                "img": "Keukenhof.jpg"
            },
            "images": [
                {
                    "title": "Plaża nad Morzem",
                    "description": "Piękna plaża z widokiem na spokojne morze, gdzie fale delikatnie obmywają brzeg. To idealne miejsce na odpoczynek, opalanie i cieszenie się letnim słońcem. Plaża jest otoczona złotym piaskiem, a w oddali widać horyzont, który zdaje się nie mieć końca. To miejsce, które koi zmysły i pozwala zapomnieć o codziennych troskach.",
                    "img": "Keukenhof.jpg"
                },
                {
                    "title": "Letni Ogród",
                    "description": "Ogród pełen zieleni i kwiatów w pełnym rozkwicie. Widać tu różnorodne rośliny, od róż po lilie, które tworzą harmonijną kompozycję kolorów i zapachów. Letni ogród to miejsce, gdzie można usiąść z książką, posłuchać śpiewu ptaków i poczuć bliskość natury. Każdy zakątek tego ogrodu kryje coś wyjątkowego.",
                    "img": "testowo.jpg"
                },
                {
                    "title": "Górska Wędrówka",
                    "description": "Widok z gór podczas letniej wędrówki, gdzie szlaki prowadzą przez malownicze krajobrazy. To doskonała okazja, aby poczuć bliskość natury i podziwiać jej majestat. Góry latem to miejsce pełne życia – od szumiących strumieni po kwitnące łąki. Każdy krok na szlaku to nowe odkrycie i niezapomniane wrażenia.",
                    "img": "Obraz078a1.jpg"
                }
            ]
        },
        "jesienna": {
            "name": "Galeria Jesienna",
            "description": "Galeria ukazująca piękno jesieni, kiedy liście zmieniają kolor na złoty, czerwony i pomarańczowy. Jesień to czas nostalgii, spacerów po parku i podziwiania mglistych poranków. W tej galerii znajdziesz obrazy pełne ciepłych barw i spokojnych krajobrazów, które przypominają o ulotności czasu i pięknie każdej chwili.",
            "location": "Gdańsk, Polska",
            "thumbnailImage": {
                "title": "Złote Liście",
                "description": "Drzewa pokryte złotymi liśćmi w parku, które tworzą niesamowity dywan na ziemi. To widok, który zachwyca każdego miłośnika jesiennych krajobrazów. Spacer po takim parku to prawdziwa uczta dla zmysłów – szelest liści pod stopami, zapach wilgotnej ziemi i delikatny powiew jesiennego wiatru.",
                "img": "PICT0068.JPG"
            },
            "images": [
                {
                    "title": "Złote Liście",
                    "description": "Drzewa pokryte złotymi liśćmi w parku, które tworzą niesamowity dywan na ziemi. To widok, który zachwyca każdego miłośnika jesiennych krajobrazów. Spacer po takim parku to prawdziwa uczta dla zmysłów – szelest liści pod stopami, zapach wilgotnej ziemi i delikatny powiew jesiennego wiatru.",
                    "img": "PICT0068.JPG"
                },
                {
                    "title": "Jesienny Spacer",
                    "description": "Spacer po lesie w jesiennej scenerii, gdzie powietrze jest rześkie, a liście szeleszczą pod stopami. To idealny sposób na relaks i kontakt z naturą. Jesienny las to miejsce pełne tajemnic i piękna, gdzie każdy krok odkrywa nowe barwy i kształty.",
                    "img": "daga.jpg"
                },
                {
                    "title": "Mglisty Poranek",
                    "description": "Poranek w lesie z delikatną mgłą, która otula drzewa i nadaje krajobrazowi tajemniczy charakter. To chwila pełna spokoju i piękna, która przypomina o magii natury. Mglisty poranek to moment, kiedy świat wydaje się zatrzymać, a każdy oddech przynosi ukojenie.",
                    "img": "PICT0241.JPG"
                }
            ]
        }
    }
    </script>
</head>

<body class="main-font">
    <div class="background-wrapper shutter">
        <nav class="navbar navbar-expand-lg fixed-top">
            <div class="navbar-border full-height full-width navbar">
                <div class="container">
                    <div class="navbar-brand" href="#">
                        <img class="logo" src="resources/img/ogrodniklogo.svg">
                        <h class="text-primary">ogrodnik projektuje</h>
                    </div>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarNav">
                        <ul class="navbar-nav ms-auto">
                            <li class="nav-item">
                                <a class="nav-link" href="/">home</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/#uslugi">oferta</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/#portfolio">portfolio</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/#kontakt">kontakt</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </nav>
        <div class="container topmost landing-page">
            <div class="d-flex flex-column h-100">
                <div class="flex-grow-1">
                    <div class="row carousel-container h-100">
                        <div class="col-sm-8 container h-100">
                            <div class="row gallery-row h-100">
                                <div id="gallery-carousel" class="flickity-carousel h-100">
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-4 d-flex ps-0">
                            <div class="row mt-4 h-100">
                                <div class="col-12 flex-grow-1 d-flex flex-column" style="height: 90%"> 
                                    <div class="flex-grow-1">
                                        <h5 id="name-label" class="fw-bold"></h5>
                                        <p id="location-label" class="mb-1"></p>
                                        <p id="date-label" class="mb-1"></p>
                                        <p id="description-label" class="mb-3"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div style="height: 200px;" class="padding-from-gutter">
                    <div class="row thumbnail-container h-100">
                        <div id="thumbnail-carousel" class="flickity-carousel h-100">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Bootstrap JS and dependencies from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
    <!-- Fotorama JS from CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fotorama/4.6.4/fotorama.min.js"></script>
    <script src="https://unpkg.com/flickity@2/dist/flickity.pkgd.min.js"></script>
    <script>
        // Get the 'gallery' parameter from the URL
        const galleryName = getQueryParam('gallery');
        const initialIndex = getQueryParam('index') ?? 0;
        const galleryData = JSON.parse(document.getElementById('galleries').textContent);
        const galleryKeys = Object.keys(galleryData);

        // Function to get URL parameters
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        function createGalleryCell(imageData, subIndex, key) {
            const galleryCell = document.createElement('div');
            galleryCell.className = 'carousel-cell';
            galleryCell.style.height = '100%';
            galleryCell.style.width = 'fit-content';
            
            // Add data attributes using dataset
            galleryCell.dataset.subindex = subIndex;
            galleryCell.dataset.key = key;
            
            const galleryImg = document.createElement('img');
            // Use data-flickity-lazyload instead of src for lazy loading
            galleryImg.setAttribute('data-flickity-lazyload', "resources/img/" + imageData.img);
            galleryImg.alt = imageData.title || 'Gallery Image';
            galleryCell.appendChild(galleryImg);

            return galleryCell;
        }

        function loadGallery(galleryName) {
            data = galleryData[galleryName];
            galleryIndex = Object.keys(galleryData).indexOf(galleryName);

            document.getElementById('name-label').innerText = data.name;
            document.getElementById('location-label').innerText = data.location;
            document.getElementById('date-label').innerText = data.date;

            var galleryCells = data.images.map((image, index) => createGalleryCell(image, index, galleryName));

            $('#gallery-carousel').append(...galleryCells);
        }


        function createThumbnailCell(gallery, galleryKey) {
            var imageData = gallery.thumbnailImage || gallery.images[0];

            const thumbCell = document.createElement('div');
            thumbCell.className = 'carousel-cell';
            thumbCell.style.height = '100%';
            thumbCell.style.width = 'fit-content';
            
            // Add data attributes for thumbnail cells too
            thumbCell.dataset.key = galleryKey;
            thumbCell.dataset.subindex = 0; // thumbnails represent the first image of each gallery

            const thumbImg = document.createElement('img');
            thumbImg.src = "resources/img/" + imageData.img;
            thumbImg.alt = imageData.title || 'Thumbnail Image';
            thumbImg.style.height = "100%";
            thumbImg.style.width = "100%";
            thumbImg.style.objectFit = "cover";
            thumbImg.style.display = "block";

            // Optional: add title/description overlay or tooltip
            thumbCell.title = imageData.title + " – " + (imageData.description || '');

            thumbCell.appendChild(thumbImg);

            // Add click handler to navigate to gallery
            thumbCell.addEventListener('click', function() {
                // Find the starting index of this gallery in the main carousel
                var startIndex = 0;
                for (let i = 0; i < galleryKeys.indexOf(galleryKey); i++) {
                    startIndex += galleryData[galleryKeys[i]].images.length;
                }
                
                // Navigate to the first image of the selected gallery
                $galleryCarousel.flickity('select', startIndex);
            });

            return thumbCell;
        }

        function updateGalleryTitle(gallery){
            document.getElementById('name-label').innerText = gallery.name;
            document.getElementById('location-label').innerText = gallery.location;
            document.getElementById('date-label').innerText = gallery.date;
        }

        function updateGalleryDescription(gallery, index){
            var imageObject = gallery.images[index];

            var descriptionLabelElement = document.getElementById('description-label');

            if(imageObject.description) {
                descriptionLabelElement.innerText = imageObject.description;
            } else{
                descriptionLabelElement.innerText = gallery.description;
            }
        }

        function updateUrl(galleryKey, index) {
            const newUrl = '?gallery=' + galleryKey + '&index=' + index;
            history.pushState({}, '', newUrl);
        }

        var thumbnailCells = galleryKeys.map((key, index) => {
            return createThumbnailCell(galleryData[key], key)
        });


        const thumbnailCarousel = document.getElementById('thumbnail-carousel');

        thumbnailCarousel.append(...thumbnailCells);

        galleryKeys.forEach(key => {
            loadGallery(key);
        })

        var currentGallery = galleryData[galleryName] || galleryData[galleryKeys[0]];

        updateGalleryDescription(currentGallery, initialIndex);
        updateGalleryTitle(currentGallery);

    </script>
    <script>
            var $galleryCarousel = $('#gallery-carousel').flickity({
                imagesLoaded: true,
                setGallerySize: false,
                percentPosition: false,
                contain: true,
                pageDots: false,
                lazyLoad: 1, // Load images in selected slide + 2 adjacent slides on each side
                on: {
                    change: function (index) {
                        var currentSlide = this.selectedElement;

                        if(!currentSlide) {
                            console.warn('No current slide found');
                            return;
                        }

                        var key = currentSlide.dataset.key;
                        var subIndex = currentSlide.dataset.subindex;
                        console.log('Current slide - Key:', key, 'SubIndex:', subIndex, "Index", index);

                        var subGallery = galleryData[key];

                        updateGalleryTitle(subGallery);
                        updateGalleryDescription(subGallery, subIndex);
                        updateUrl(key, subIndex);
                    }
                }
            });
    
            var $thumbnailCarousel = $('#thumbnail-carousel').flickity({
                imagesLoaded: true,
                contain: true,
                pageDots: false,
                prevNextButtons: false,
                cellAlign: 'center'
            });
    </script>
</body>

</html>